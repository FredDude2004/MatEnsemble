FROM ghcr.io/freddude2004/matensemble-base:baseline

ENV DEBIAN_FRONTEND=noninteractive
SHELL ["/bin/bash", "-c"]

RUN apt-get update && apt-get install -y --no-install-recommends \
    curl    git    gcc

# install uv
RUN curl -LsSf https://astral.sh/uv/install.sh | env UV_INSTALL_DIR=/usr/local/bin sh; \
    export PATH="/usr/local/bin:${PATH}"; \
    uv --version

# setup uv to install deps to /opt/venv
ENV UV_PROJECT_ENVIRONMENT=/opt/venv

# clone MatEnsemble
RUN set -euo pipefail; \
    mkdir -p /opt/src; \
    cd /opt/src; \
    rm -rf MatEnsemble; \
    git clone --depth 1 https://github.com/FredDude2004/MatEnsemble.git; \
    cd MatEnsemble; \
    uv sync --extra flux --no-editable

ENV VIRTUAL_ENV=/opt/venv
ENV PATH="${VIRTUAL_ENV}/bin:${PATH}"




