 matensemble.def
  Bootstrap: localimage
  From: /lustre/orion/lrn090/scratch/kaleb/apptainer/matensemble/matensemble_base.sif

  %post
      # install uv
      curl -LsSf https://astral.sh/uv/install.sh | env UV_INSTALL_DIR=/usr/local/bin sh
      export PATH="/usr/local/bin:${PATH}"
      uv --version

      # clone MatEnsemble
      mkdir -p /opt/src
      cd /opt/src
      rm -rf MatEnsemble
      git clone --depth 1 https://github.com/FredDude2004/MatEnsemble.git
      cd MatEnsemble

      # install all dependencies and matensemble
      export UV_PROJECT_ENVIRONMENT=/opt/venv
      uv sync --all-extras --dev --no-editable

  %environment
      export VIRTUAL_ENV=/opt/venv
      export PATH="${VIRTUAL_ENV}/bin:${PATH}"

  %runscript
    flux start

  %help
  ___  ___      _   _____                         _     _
  |  \/  |     | | |  ___|                       | |   | |
  | .  . | __ _| |_| |__ _ __  ___  ___ _ __ ___ | |__ | | ___
  | |\/| |/ _` | __|  __| '_ \/ __|/ _ \ '_ ` _ \| '_ \| |/ _ \
  | |  | | (_| | |_| |__| | | \__ \  __/ | | | | | |_) | |  __/
  \_|  |_/\__,_|\__\____/_| |_|___/\___|_| |_| |_|_.__/|_|\___|

  Version: 0.1.2
  GitHub:  https://github.com/Q-CAD/MatEnsemble
  Documentation: https://link/to/documention

  An adaptive and highly asynchronous ensemble simulation workflow
  manager with in-memory dynamics and on-the-fly analysis capabilties.

  # TODO: add a description of how to use here
  Usage: apptainer run <path_to_matensemble>.sif
  More info: https://link/to/documention

  module load olcf-container-tools
  module load apptainer-enable-mpi apptainer-enable-gpu
  
